From eb44f5c17113c9d219866ca2d9d24980be03f959 Mon Sep 17 00:00:00 2001
From: karthick111 <lensflare21@gmail.com>
Date: Thu, 15 Dec 2016 02:26:48 +0100
Subject: [PATCH 1/1] FNW for old egl

Change-Id: I1a3f84bb8418b5096ffda7113aba009a8517711d
---
 services/surfaceflinger/Android.mk        | 4 ++++
 services/surfaceflinger/DisplayDevice.cpp | 8 ++++++++
 2 files changed, 12 insertions(+)

diff --git a/services/surfaceflinger/Android.mk b/services/surfaceflinger/Android.mk
index 9093d8f..1c4768c 100644
--- a/services/surfaceflinger/Android.mk
+++ b/services/surfaceflinger/Android.mk
@@ -143,6 +143,10 @@ ifeq ($(BOARD_USE_BGRA_8888),true)
     LOCAL_CFLAGS += -DUSE_BGRA_8888
 endif
 
+ifeq ($(BOARD_EGL_NEEDS_FNW),true)
+    LOCAL_CFLAGS += -DEGL_NEEDS_FNW
+endif
+
 LOCAL_CFLAGS += -fvisibility=hidden -Werror=format
 LOCAL_CFLAGS += -std=c++14
 
diff --git a/services/surfaceflinger/DisplayDevice.cpp b/services/surfaceflinger/DisplayDevice.cpp
index a3b0cfe..fa89330 100644
--- a/services/surfaceflinger/DisplayDevice.cpp
+++ b/services/surfaceflinger/DisplayDevice.cpp
@@ -47,6 +47,10 @@
 #include "SurfaceFlinger.h"
 #include "Layer.h"
 
+#ifdef EGL_NEEDS_FNW
+#include <ui/FramebufferNativeWindow.h>
+#endif
+
 // ----------------------------------------------------------------------------
 using namespace android;
 // ----------------------------------------------------------------------------
@@ -105,7 +109,11 @@ DisplayDevice::DisplayDevice(
 {
     Surface* surface;
     mNativeWindow = surface = new Surface(producer, false);
+#ifndef EGL_NEEDS_FNW
     ANativeWindow* const window = mNativeWindow.get();
+#else
+    ANativeWindow* const window = new FramebufferNativeWindow();
+#endif
     char property[PROPERTY_VALUE_MAX];
 
     /*
-- 
2.1.4

